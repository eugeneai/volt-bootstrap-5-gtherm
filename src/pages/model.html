<!--

=========================================================
* Volt Pro - Premium Bootstrap 5 Dashboard
=========================================================

* Product Page: https://themesberg.com/product/admin-dashboard/volt-bootstrap-5-dashboard
* Copyright 2021 Themesberg (https://www.themesberg.com)
* License (https://themesberg.com/licensing)

* Designed and coded by https://themesberg.com

=========================================================

* The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software. Please contact us to request a removal.

-->
<!DOCTYPE html>
<html lang="en">

<head>
    @@include('./_head.html', {
        "path": "../",
        "title": "Geotherm model parameters defienition"
    })
</head>

<body>

        <!-- NOTICE: You can use the _analytics.html partial to include production code specific code & trackers -->
        @@if (environment === 'production') {
            @@include('../_analytics_body.html')
        }

        @@include('./dashboard/_nav.html', {
            "path": "../"
        })

        @@include('./dashboard/_sidenav.html', {
            "path": "../",
            "page": "model",
        })

        <main class="content">

            @@include('./dashboard/_topbar.html', {
                "path": "../"
            })

            <div class="py-4">
                <nav aria-label="breadcrumb" class="d-none d-md-inline-block">
                    <ol class="breadcrumb breadcrumb-dark breadcrumb-transparent">
                        <li class="breadcrumb-item">
                            <a href="#">
                                <svg class="icon icon-xxs" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
                            </a>
                        </li>
                        <li class="breadcrumb-item"><a href="#">Geotherm</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Model</li>
                    </ol>
                </nav>
                <div class="d-flex justify-content-between w-100 flex-wrap">
                    <div class="mb-3 mb-lg-0">
                        <h1 class="h4">Model Paremeters Definition</h1>
                        <p class="mb-0">Here You can define parameters for a geotherm model.</p>
                    </div>
                    <div hidden="true">
                        <a href="https://themesberg.com/docs/volt-bootstrap-5-dashboard/components/forms/" class="btn btn-outline-gray"><i class="far fa-question-circle me-1"></i> Forms Docs</a>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-12 mb-4">
                    <div class="card border-1 show components-section">
                        <div class="card-body">
                            <div class="row mb-4" id="vue-model">
                                <div class="col-lg-4 col-sm-6">
                                    <!-- Form -->
                                    <div class="mb-1">
                                        <label for="q0">q0 [mW/m^2] surface heat flow valaue range</label>
                                        <input type="text" class="form-control"
                                               id="q0" aria-describedby="q0help"
                                               value="34:1:40"
                                               v-model="model.q0">
                                        <small id="q0help" class="form-text text-muted">Julia format range in form [start:increment:end], usually [30:1:40].</small>
                                    </div>
                                    <div class="mb-1">
                                        <label for="D">D [km] thickness of upper crust</label>
                                        <input type="text" class="form-control" id="D"
                                               aria-describedby="Dhelp" value="16"
                                               v-model="model.D">
                                        <small id="Dhelp" class="form-text text-muted">Usually 16 km, having in mind the crust's thickness to be 40-45 km.</small>
                                    </div>
                                    <div class="mb-1">
                                        <label for="Zbot">Zbot [km] vector of base of lithospheric layers</label>
                                        <input type="text" class="form-control" id="Zbot"
                                               aria-describedby="Zbothelp" value="[16,23,39,300]"
                                               v-model="model.Zbot">
                                        <small id="Zbothelp" class="form-text text-muted">Usually this vector is [16,23,39,300] km.</small>
                                    </div>
                                    <div class="mb-1">
                                        <label for="Zmax">Zmax [km] maximum depth of model</label>
                                        <input type="text" class="form-control" id="Zmax"
                                               aria-describedby="Zmaxhelp" value="255"
                                               v-model="model.Zmax">
                                        <small id="Zmaxhelp" class="form-text text-muted">Usually this vector is [16,23,39,300] km.</small>
                                    </div>
                                    <!-- End of Form -->
                                </div>
                                <div class="col-lg-4 col-sm-6">
                                    <!-- Form -->
                                    <div class="mb-1">
                                        <label for="Dz">Dz [km] depth modeling step<br/>&nbsp;</label>
                                        <input type="text" class="form-control" id="Dz"
                                               aria-describedby="Dzhelp" value="0.1"
                                               v-model="model.Dz">
                                        <small id="Dzhelp" class="form-text text-muted">Usually it is 0.1 km, smaller values will not improve model relevance.</small>
                                    </div>
                                    <div class="mb-1">
                                        <label for="P">P partition coefficient for upper crustal</label>
                                        <input type="text" class="form-control" id="P"
                                               aria-describedby="Phelp" value="0.74"
                                               v-model="model.P">
                                        <small id="Phelp" class="form-text text-muted">Usually 0.74</small>
                                    </div>
                                    <div class="mb-1">
                                        <label for="H">H [uW/m^3] vector of heat production of lithospheric ....</label>
                                        <input type="text" class="form-control" id="H"
                                               aria-describedby="Hhelp" value="[0,0.4,0.4,0.02]"
                                               v-model="model.H">
                                        <small id="Hhelp" class="form-text text-muted">Usually this vector is [0,0.4,0.4,0.2].</small>
                                    </div>
                                    <div class="mb-1">
                                        <label for="iref">iref index to reference heat flow for elevation computation</label>
                                        <input type="text" class="form-control" id="iref"
                                               aria-describedby="irefhelp" value="3"
                                               v-model="model.iref">
                                        <small id="irefhelp" class="form-text text-muted">Usually it is 3.</small>
                                    </div>
                                    <!-- End of Form -->
                                </div>
                                <div class="col-lg-4 col-sm-6">
                                    <!-- Form -->
                                    <div class="mb-4">
                                        <label for="optimize">Apply optimization stages</label>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="optimize"
                                                   v-model="model.optimize">
                                            <label class="form-check-label" for="flexSwitchCheckDefault">Optimize results</label><br/>
                                            <small class="form-text text-muted">Optimization allows one to calculate optimal q0 value.</small>
                                        </div>
                                    </div>
                                    <div class="mb-1">
                                        <div class="btn-group" role="group" aria-label="Basic example">
                                            <a class="btn btn-primary" href="#" role="button" v-on:click="calculate()">Calculate</a>
                                            <button type="button" class="btn btn-primary" v-on:click="save()">Save</button>
                                        </div>
                                    </div>
                                </div>
                        </div>
                </div>
            </div>

            @@include('./dashboard/_footer.html', {
                "path": ".",
                "classes": "bg-dark text-white"
            })
        </main>

        @@include('./_scripts.html', {
        "path": "../"
        })

        <script>
         function checkModelPrequisites() {
             let proceed = true;
             if (!isValidUserCookie()) {
                 proceed = false;
                 Swal.fire({
                     position: 'top',
                     icon: 'error',
                     title: 'Please login or register!',
                     showConfirmButton: true,
                     timer: 10000
                 }).then(redirectToLogin);
             };
             if (!proceed) return undefined;
             if (!checkData(this)) {
                 proceed = false;
                 Swal.fire({
                     position: 'top',
                     icon: 'error',
                     title: 'Please enter correct model parameters!',
                     showConfirmButton: true,
                     timer: 10000
                 })
             }
             if (!proceed) return undefined;

             let prj_uuid = getProjectUUID();
             if (prj_uuid === undefined) {
                 proceed = false;
                 Swal.fire({
                     position: 'top',
                     icon: 'error',
                     title: 'You must select (click) on a project at Dashboard page! You will be redirected.',
                     showConfirmButton: true,
                     timer: 10000
                 })
                     .then(redirectToDashboard);
             }
             return prj_uuid;
         }

         function checkData(data) {
             return true;
         }
         let modelApp = Vue.createApp({
             data() {
                 return {
                     model: {
                         q0:"34:1:40"
                         , D:"16"
                         , Zbot:"[16,23,39,300]"
                         , Zmax:"255"
                         , Dz:"0.1"
                         , P:"0.74"
                         , H:"[0,0.4,0.4,0.02]"
                         , iref:"3"
                         , optimize:false
                     },
                     saved:true
                 }
             },
             methods: {
                 calculate() {

                     let prj_uuid = checkModelPrequisites();

                     let proceed = (prj_uuid != undefined);

                     if (!proceed) return;
                     swal.fire({
                         position: "top",
                         icon: "info",
                         title: "Requesting the server for computation .....",
                         showConfirmButton: false,
                         timer: 3000
                     })
                     axios.post(SA+"project/"+prj_uuid+"/calculate")
                          .then(resp => {
                              js = resp.data;
                              if (js.level < ERROR) {
                                  Swal.fire({
                                      position: 'top',
                                      icon: 'success',
                                      title: 'Modelling has finished sucessfully! See results in "Graphs" and "Table" pages.',
                                      showConfirmButton: true,
                                      timer: 10000
                                  })
                              } else {
                                  Swal.fire({
                                      position: 'top',
                                      icon: 'error',
                                      title: 'Modelling has failed! Model returns the following error message: ' + js.description,
                                      showConfirmButton: true,
                                      timer: 10000
                                  })
                              }
                          })
                          .catch(error => {
                              Swal.fire({
                                  position: 'top',
                                  icon: 'error',
                                  title: 'Server communication error! (or some other problem)',
                                  showConfirmButton: true,
                                  timer: 10000

                              })
                          });
                 },
                 save() {
                     let prj_uuid = checkModelPrequisites();
                     axios.post(SA+"project/" + prj_uuid + "/savemodel", this.model)
                          .then(resp => {
                              js = resp.data;
                              if (js.level < ERROR) {
                                  Swal.fire({
                                      position: 'top',
                                      icon: 'success',
                                      title: 'Your data saved! ' + js.description,
                                      showConfirmButton: false,
                                      timer: 3000
                                  });
                                  this.saved = true;
                              } else {
                                  Swal.fire({
                                      position: 'top',
                                      icon: 'error',
                                      title: 'Saving has failed! Server notes: ' + js.description,
                                      showConfirmButton: true,
                                      timer: 10000
                                  })
                              }
                          })
                          .catch(error => {
                              Swal.fire({
                                  position: 'top',
                                  icon: 'error',
                                  title: 'Server communication error! (or some other problem)',
                                  showConfirmButton: true,
                                  timer: 10000
                              })
                          });
                 }
             }
         }).mount("#vue-model")
        </script>
</body>

</html>
