<!--

=========================================================
* Volt Pro - Premium Bootstrap 5 Dashboard
=========================================================

* Product Page: https://themesberg.com/product/admin-dashboard/volt-bootstrap-5-dashboard
* Copyright 2021 Themesberg (https://www.themesberg.com)
* License (https://themesberg.com/licensing)

* Designed and coded by https://themesberg.com

=========================================================

* The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software. Please contact us to request a removal.

-->
<!DOCTYPE html>
<html lang="en">

<head>
    @@include('./_head.html', {
        "path": "../",
        "title": "Geotherm model parameters defienition"
    })
</head>

<body>

        <!-- NOTICE: You can use the _analytics.html partial to include production code specific code & trackers -->
        @@if (environment === 'production') {
            @@include('./_analytics_body.html')
        }

        @@include('./dashboard/_nav.html', {
            "path": ".."
        })

        @@include('./dashboard/_sidenav.html', {
            "path": "..",
            "page": "graphs"
        })

        <main class="content">

            @@include('./dashboard/_topbar.html', {
                "path": ".."
            })

            <div class="py-4">
                <nav aria-label="breadcrumb" class="d-none d-md-inline-block">
                    <ol class="breadcrumb breadcrumb-dark breadcrumb-transparent">
                        <li class="breadcrumb-item">
                            <a href="#">
                                <svg class="icon icon-xxs" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
                            </a>
                        </li>
                        <li class="breadcrumb-item"><a href="#">Geotherm</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Graphs</li>
                    </ol>
                </nav>
                <div class="d-flex justify-content-between w-100 flex-wrap">
                    <div class="mb-3 mb-lg-0">
                        <h1 class="h4">Model results graphs</h1>
                        <p class="mb-0">We used stock Julia/Python Matlab like graphs to show the results.</p>
                    </div>
                    <div hidden="true">
                        <a href="https://themesberg.com/docs/volt-bootstrap-5-dashboard/components/forms/" class="btn btn-outline-gray"><i class="far fa-question-circle me-1"></i> Forms Docs</a>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-12 mb-4">
                    <div class="card border-1 show components-section"
                         id="vue-graph-plots">
                        <div class="card-body">
                            <div class="row mb-4">
                                <div class="col-lg-6 col-sm-6">
                                    <!-- Graph set -->
                                    <div class="mb-4">
                                        <label for="multy-graph">Geotherms for each q0 value</label>
                                        <div v-html="geotherms">
                                            <img src="../assets/img/illustrations/geotherm.svg"
                                                 class="img-fluid" alt="Geotherms result graph">
                                        </div>
                                        <button class="btn btn-sm btn-gray-800 d-inline-flex align-items-center"
                                                v-on:click="download('geotherms')"
                                                v-bind:disabled="disabled('geotherms')">
                                            <svg class="icon icon-xs me-2" fill="#ffffff" stroke="currentColor" version="1.1" id="_x32_" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" xml:space="preserve" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g> <path class="st0" d="M242.956,313.537c3.442,4.534,8.073,7.034,13.044,7.034c4.971,0,9.602-2.5,13.024-7.011l94.723-119.88 c3.517-4.639,4.493-9.126,2.75-12.636c-1.743-3.51-5.906-5.443-11.726-5.443h-36.26c-9.866,0-17.894-8.024-17.894-17.892V43.661 c0-11.623-9.452-21.079-21.073-21.079h-47.087c-11.621,0-21.073,9.456-21.073,21.079V157.71c0,9.868-8.028,17.892-17.896,17.892 h-36.26c-5.817,0-9.98,1.933-11.724,5.443c-1.743,3.509-0.767,7.997,2.77,12.659L242.956,313.537z"></path> <path class="st0" d="M511.934,360.164l-48.042-160.14h-58.09l-28.242,50.885h36.246L444.7,359.03H67.3l30.893-108.121h36.246 l-28.242-50.885h-58.09L0,360.622v103.354c0,14.03,11.413,25.442,25.441,25.442h461.118c14.028,0,25.441-11.413,25.441-25.442 v-55.652L511.934,360.164z"></path> </g> </g></svg>
                                            Download this figure
                                        </button><br/>

                                        <small id="mghelp" class="form-text text-muted">In the legend, each line marked by a q0 value and the depth, where the geotherm crosses the adiabat. </small>
                                    </div>
                                    <div class="mb-4">
                                        <label for="multy-graph">Spline approximation of Chi^2 deviation value</label>
                                        <div v-html="chisquare">
                                            <img src="../assets/img/illustrations/geotherm-chisquare.svg"
                                                 class="img-fluid" alt="Geotherms result graph">
                                        </div>
                                        <button class="btn btn-sm btn-gray-800 d-inline-flex align-items-center"
                                                v-on:click="download('chisquare')"
                                                v-bind:disabled="disabled('chisquare')">
                                            <svg class="icon icon-xs me-2" fill="#ffffff" stroke="currentColor" version="1.1" id="_x32_" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" xml:space="preserve" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g> <path class="st0" d="M242.956,313.537c3.442,4.534,8.073,7.034,13.044,7.034c4.971,0,9.602-2.5,13.024-7.011l94.723-119.88 c3.517-4.639,4.493-9.126,2.75-12.636c-1.743-3.51-5.906-5.443-11.726-5.443h-36.26c-9.866,0-17.894-8.024-17.894-17.892V43.661 c0-11.623-9.452-21.079-21.073-21.079h-47.087c-11.621,0-21.073,9.456-21.073,21.079V157.71c0,9.868-8.028,17.892-17.896,17.892 h-36.26c-5.817,0-9.98,1.933-11.724,5.443c-1.743,3.509-0.767,7.997,2.77,12.659L242.956,313.537z"></path> <path class="st0" d="M511.934,360.164l-48.042-160.14h-58.09l-28.242,50.885h36.246L444.7,359.03H67.3l30.893-108.121h36.246 l-28.242-50.885h-58.09L0,360.622v103.354c0,14.03,11.413,25.442,25.441,25.442h461.118c14.028,0,25.441-11.413,25.441-25.442 v-55.652L511.934,360.164z"></path> </g> </g></svg>
                                            Download this figure
                                        </button><br/>
                                        <small id="mghelp" class="form-text text-muted">Spline approximation of Chi^2 (deviation assessment between measured and calculated values at the same temperature value) approximation. BFGS (a Qusi Newton method) used for figuring the suboptimal value for q0 is used. </small>
                                    </div>
                                </div>
                                <div class="col-lg-6 col-sm-6">
                                    <!-- Form -->
                                    <div class="mb-4">
                                        <label for="multy-graph">The [sub]optimal Geotherm</label>
                                        <div v-html="optimized">
                                            <img src="../assets/img/illustrations/geotherm-opt.svg"
                                                 class="img-fluid" alt="The suboptimal geotherm result graph">
                                        </div>
                                        <button class="btn btn-sm btn-gray-800 d-inline-flex align-items-center"
                                                v-on:click="download('optimized')"
                                                v-bind:disabled="disabled('optimized')">
                                            <svg class="icon icon-xs me-2" fill="#ffffff" stroke="currentColor" version="1.1" id="_x32_" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" xml:space="preserve" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g> <path class="st0" d="M242.956,313.537c3.442,4.534,8.073,7.034,13.044,7.034c4.971,0,9.602-2.5,13.024-7.011l94.723-119.88 c3.517-4.639,4.493-9.126,2.75-12.636c-1.743-3.51-5.906-5.443-11.726-5.443h-36.26c-9.866,0-17.894-8.024-17.894-17.892V43.661 c0-11.623-9.452-21.079-21.073-21.079h-47.087c-11.621,0-21.073,9.456-21.073,21.079V157.71c0,9.868-8.028,17.892-17.896,17.892 h-36.26c-5.817,0-9.98,1.933-11.724,5.443c-1.743,3.509-0.767,7.997,2.77,12.659L242.956,313.537z"></path> <path class="st0" d="M511.934,360.164l-48.042-160.14h-58.09l-28.242,50.885h36.246L444.7,359.03H67.3l30.893-108.121h36.246 l-28.242-50.885h-58.09L0,360.622v103.354c0,14.03,11.413,25.442,25.441,25.442h461.118c14.028,0,25.441-11.413,25.441-25.442 v-55.652L511.934,360.164z"></path> </g> </g></svg>
                                            Download this figure
                                        </button><br/>
                                        <small id="mghelp" class="form-text text-muted">A suboptimal q0 aproximation with a spline. </small>
                                    </div>
                                </div>
                        </div>
                </div>
            </div>


            @@include('./dashboard/_footer.html', {
                "path": "../",
                "classes": "bg-dark text-white"
            })
        </main>

        @@include('./_scripts.html', {
        "path": ".."
        })

        <script>
         graphApp = Vue.createApp({
             data() {
                 return {
                     geotherms: "",
                     chisquare: "",
                     optimized: ""
                 };
             },
             mounted() {
                 var vueData = this;
                 let uuid = undefined;
                 if (uuid === undefined) {
                     this.geotherms = '<div class="alert alert-primary" role="alert">Calculate model, and here You get a graphs</div>'
                     this.chisquare = '<div  class="alert alert-primary" role="alert">Calculate model with <button>optimization</button>, and here You get a chi-square assessment.</div>'
                     this.optimized = '<div  class="alert alert-primary" role="alert">Calculate model with <button>optimization</button>, You will get a geotherm graphs for the optimal value.</div>'
                 }
                 uuid = getProjectUUID();
                 if (uuid === undefined) return;
                 axios.post(SA+"project/"+uuid+"/graphs")
                      .then( resp => {
                          js = resp.data;
                          if (js.level < ERROR) {
                              let graphs = js.value.figures;
                              let figNames = {};
                              graphs.forEach( gr => {
                                  vueData[gr.key] = gr.figure;
                                  figNames[gr.key] = true;
                              });
                              vueData.figNames=figNames;
                          } else {
                              Swal.fire({
                                  position: 'top',
                                  icon: 'error',
                                  title: 'Cannot load graphs: ' + js.description,
                                  showConfirmButton: true,
                                  timer: 10000
                              });
                          }
                      })
                      .catch(error => {
                          Swal.fire({
                              position: 'top',
                              icon: 'error',
                              title: 'Communication Error: Cannot load graphs',
                              showConfirmButton: true,
                              timer: 10000
                          });
                      });
             },
             methods: {
                 download(figure) {
                     uuid = getProjectUUID();
                     if (figure in this.figNames) {
                         axios({
                             url:SA+"project/" + uuid +
                                 "/figure/" + figure,
                             method: "GET",
                             responseType: 'blob'
                         })
                             .then( resp => {
                                 // create file link in browser's memory
                                 const href = URL.createObjectURL(resp.data);

                                 // create "a" HTML element with href to file & click
                                 const link = document.createElement('a');
                                 link.href = href;
                                 link.setAttribute('download', figure+'.svg'); //or any other extension
                                 document.body.appendChild(link);
                                 link.click();

                                 // clean up "a" element & remove ObjectURL
                                 document.body.removeChild(link);
                                 URL.revokeObjectURL(href);
                             })
                         .catch( error => {
                             Swal.fire({
                                 position: 'top',
                                 icon: 'error',
                                 title: 'Cannot download file "' + figure + '.svg"',
                                 showConfirmButton: true,
                                 timer: 10000
                             });
                         })
                     } else {
                         alert("Should not came here!");
                     }
                 },
                 disabled(figure) {
                     if ("figNames" in this) {
                         return ! (figure in this.figNames);
                     } else {
                         return true;
                     }
                 }
             }
         }).mount("#vue-graph-plots");
        </script>

</body>

</html>
